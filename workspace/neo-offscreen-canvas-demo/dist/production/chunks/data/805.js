"use strict";(self.webpackChunkneo_offscreen_canvas_demo=self.webpackChunkneo_offscreen_canvas_demo||[]).push([[805],{805:(e,s,t)=>{t.r(s),t.d(s,{default:()=>n});var o=t(727),r=t(846);class a extends o.A{static config={className:"Neo.manager.rpc.Message",singleton:!0,sorters:[{direction:"ASC",property:"id"}]};endPointTimeouts=[];messageId=1;requestBuffer=20;socketConnections={};transactionId=1;onMessage(e){let s=Neo.manager.rpc.Api.get(`${e.service}.${e.method}`);return this[`onMessage${Neo.capitalize(s.type)}`](e,s)}onMessageAjax(e,s){return new Promise(((t,o)=>{let r=this,{url:a}=s;r.register({id:r.messageId,method:e.method,params:e.params,reject:o,resolve:t,service:e.service,transactionId:0,url:a}),r.messageId++,r.endPointTimeouts.includes(a)||(r.endPointTimeouts.push(a),r.timeout(r.requestBuffer).then((()=>{r.resolveBufferTimeout(a)})))}))}async onMessageWebsocket(e,s){let o=this,{url:r}=s,a=o.socketConnections[r];if(!a){let e=await t.e(851).then(t.bind(t,851));o.socketConnections[r]=a=Neo.create(e.default,{serverAddress:r})}return await a.promiseMessage(e)}async resolveBufferTimeout(e){let s,t=this,o=[],a=t.find({transactionId:0,url:e}),n=[],{transactionId:i}=t;a.forEach((e=>{e.transactionId=i,o.push(e.id),n.push({id:e.id,method:e.method,params:e.params,service:e.service})})),r.A.remove(t.endPointTimeouts,e),t.transactionId++,s=await Neo.Fetch.request(e,{},"post",JSON.stringify({tid:i,requests:n})),a.forEach((e=>{e.resolve()})),t.remove(o)}}const n=Neo.setupClass(a)}}]);