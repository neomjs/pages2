import e from"./Neo.mjs";import*as o from"./core/_export.mjs";import t from"./main/DomAccess.mjs";import n from"./main/DomEvents.mjs";import i from"./core/Observable.mjs";import a from"./worker/Manager.mjs";class r extends o.Base{static getStaticConfig(){return{observable:!0}}static getConfig(){return{className:"Neo.Main",mode:"read",openWindows:{},readQueue:[],remote:{app:["alert","editRoute","getWindowData","setNeoConfig","setRoute","windowClose","windowMoveTo","windowOpen","windowResizeTo"]},running:!1,showFps:!1,singleton:!0,timeLimit:15,totalFrameCount:0,updateQueue:[],writeQueue:[]}}constructor(o){"development"===e.config.environment&&"function"==typeof window.webkitConvertPointFromNodeToPage&&(document.body.innerHTML=["Please use Chrome for the development mode.</br>","For details, see the open Ticket: ",'<a style="color:red;" href="https://github.com/neomjs/neo/issues/191">Safari: Worker should support ES6 modules</a>'].join("")),super(o);let t=this;a.on({automount:t.onRender,"message:mountDom":t.onMountDom,"message:updateDom":t.onUpdateDom,updateVdom:t.onUpdateVdom,scope:t}),n.on("domContentLoaded",t.onDomContentLoaded,t),"loading"!==document.readyState&&n.onDomContentLoaded()}alert(e){alert(e)}editRoute(e){let o=n.parseHash(window.location.hash.substr(1)),t=[];"string"==typeof e&&(e=n.parseHash(e)),Object.assign(o,e),Object.entries(o).forEach((([e,o])=>{null!==o&&t.push(encodeURIComponent(e)+"="+encodeURIComponent(o))})),window.location.hash=t.join("&")}getWindowData(){const e=window,o=e.screen;return{innerHeight:e.innerHeight,innerWidth:e.innerWidth,outerHeight:e.outerHeight,outerWidth:e.outerWidth,screen:{availHeight:o.availHeight,availLeft:o.availLeft,availTop:o.availTop,availWidth:o.availWidth,colorDepth:o.colorDepth,height:o.height,orientation:{angle:o.orientation.angle,type:o.orientation.type},pixelDepth:o.pixelDepth,width:o.width},screenLeft:e.screenLeft,screenTop:e.screenTop}}globalResizeListener(e){console.log("globalResizeListener",e)}async onDomContentLoaded(){let o=this,n=e.config,i=[];t.onDomContentLoaded(),"development"!==n.environment&&(__webpack_require__.p=n.basePath.substring(6)),n.mainThreadAddons.forEach((e=>{"AnalyticsByGoogle"!==e&&i.push(import(`./main/addon/${e}.mjs`))})),(n.useGoogleAnalytics||n.mainThreadAddons.includes("AnalyticsByGoogle"))&&i.push(import("./main/addon/AnalyticsByGoogle.mjs"));const r=await Promise.all(i);o.addon={},r.forEach((e=>{o.addon[e.default.constructor.name]=e.default})),a.onWorkerConstructed({origin:"main"})}onMountDom(e){this.queueWrite(e),a.sendMessage(e.origin||"app",{action:"reply",replyId:e.id,success:!0})}onRender(e){e.data.replyId=e.replyId,this.queueWrite(e.data)}onUpdateDom(e){this.queueUpdate(e)}onUpdateVdom(e){e.data.replyId=e.replyId,this.queueUpdate(e.data)}processQueue(e,o){let n,i=this,r=i.timeLimit;for(;n=e.shift();){if(new Date-o>r)return e.unshift(n),requestAnimationFrame(i.renderFrame.bind(i));t[i.mode](n),a.resolveDomOperationPromise(n.replyId)}}queueRead(e){let o=this;o.readQueue.push(e),o.running||(o.running=!0,requestAnimationFrame(o.renderFrame.bind(o)))}queueUpdate(e){let o=this;o.updateQueue.push(e),o.running||(o.running=!0,requestAnimationFrame(o.renderFrame.bind(o)))}queueWrite(e){let o=this;o.writeQueue.push(e),o.running||(o.running=!0,requestAnimationFrame(o.renderFrame.bind(o)))}renderFrame(){let o=this,t=o.readQueue,n=o.updateQueue,i=o.writeQueue,a="read"===o.mode,r=new Date;e.config.logDeltaUpdates&&(o.totalFrameCount++,console.log("Total Frames: "+o.totalFrameCount)),(!a&&i.length||(o.mode="read",!o.processQueue(t,r)))&&(n.length&&(o.mode="update",o.processQueue(n,r))||i.length&&(o.mode="write",o.processQueue(i,r))||(o.running=!1))}setRoute(e){window.location.hash=e.value}setNeoConfig(o){e.config[o.key]=o.value}windowClose(e){Array.isArray(e.names)||(e.names=[e.names]),e.names.forEach((e=>{this.openWindows[e].close(),delete this.openWindows[e]}))}windowMoveTo(e){this.openWindows[e.windowName].moveTo(e.x,e.y)}windowOpen(e){this.openWindows[e.windowName]=window.open(e.url,e.windowName,e.windowFeatures)}windowResizeTo(e){let o=this.openWindows[e.windowName],t=e.height||o.outerHeight,n=e.width||o.outerWidth;o.resizeTo(n,t)}}e.applyClassConfig(r);let s=e.create(r);e.applyToGlobalNs(s);export default s;