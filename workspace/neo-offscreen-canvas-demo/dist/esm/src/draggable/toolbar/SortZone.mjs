import t from"./DragZone.mjs";import e from"../../util/VDom.mjs";class i extends t{static getConfig(){return{className:"Neo.draggable.toolbar.SortZone",ntype:"toolbar-sortzone",alwaysFireDragMove:!0,currentIndex:-1,indexMap:null,itemRects:null,itemStyles:null,ownerRect:null,ownerStyle:null,reversedLayoutDirection:!1,sortDirection:"horizontal",startIndex:-1}}moveTo(t,e){this.owner.moveTo(t,e)}onDragEnd(t){let e,i=this,n=i.owner,o=i.itemStyles,l=n.style||{};n.sortable&&(l.height=i.ownerStyle.height||null,l.width=i.ownerStyle.width||null,n.style=l,n.items.forEach(((t,n)=>{e=t.style||{},Object.assign(e,{height:o[n].height||null,left:null,position:null,top:null,width:o[n].width||null}),n===i.startIndex&&(e.visibility=null),t.style=e})),i.startIndex!==i.currentIndex&&i.moveTo(i.startIndex,i.currentIndex),Object.assign(i,{currentIndex:-1,indexMap:null,itemRects:null,itemStyles:null,ownerRect:null,startIndex:-1}),i.dragEnd(t))}onDragMove(t){if(this.itemRects){let e,i,n=this,o=.55,l=n.currentIndex,r=n.itemRects,s=r.length-1,h=n.reversedLayoutDirection;"horizontal"===n.sortDirection?(e=t.clientX-n.offsetX-r[l].left,i="width"):(e=t.clientY-n.offsetY-r[l].top,i="height"),l>0&&(!h&&e<0||h&&e>0)?Math.abs(e)>r[l-1][i]*o&&(n.currentIndex--,n.switchItems(l,n.currentIndex)):l<s&&(!h&&e>0||h&&e<0)&&Math.abs(e)>r[l+1][i]*o&&(n.currentIndex++,n.switchItems(l,n.currentIndex))}}onDragStart(t){let i,n,o,l,r=this,s=Neo.getComponent(t.path[0].id),h=r.owner,d=r.itemStyles=[],a=h.layout,c=h.style||{};h.sortable&&(i=h.indexOf(s.id),n={},Object.assign(r,{currentIndex:i,dragElement:e.findVdomChild(h.vdom,s.id).vdom,dragProxyConfig:{...r.dragProxyConfig,cls:[...h.cls]},indexMap:n,ownerStyle:{height:c.height,width:c.width},reversedLayoutDirection:"column-reverse"===a.direction||"row-reverse"===a.direction,sortDirection:"layout-vbox"===h.layout.ntype?"vertical":"horizontal",startIndex:i}),r.dragStart(t),h.items.forEach(((t,e)=>{n[e]=e,d.push({height:t.style?.height,width:t.style?.width})})),Neo.main.DomAccess.getBoundingClientRect({id:[h.id].concat(h.items.map((t=>t.id)))}).then((t=>{r.ownerRect=t[0],c.height=`${t[0].height}px`,c.width=`${t[0].width}px`,h.style=c,t.shift(),r.itemRects=t,h.items.forEach(((e,i)=>{o=e.style||{},l=t[i],e.style=Object.assign(o,{height:`${l.height}px`,left:`${l.left}px`,position:"absolute",top:`${l.top}px`,width:`${l.width}px`})})),setTimeout((()=>{o=s.style||{},o.visibility="hidden",s.style=o}),30)})))}switchItems(t,e){let i,n=this,o=n.reversedLayoutDirection;(!o&&e<t||o&&t<e)&&(i=t,t=e,e=i);let l=n.itemRects,r=n.indexMap,s=l[t],h=l[e],d={...s},a={...h};"horizontal"===n.sortDirection?(s.width=a.width,h.left=d.left+a.width,h.width=d.width):(s.height=a.height,h.height=d.height,h.top=d.top+a.height),i=r[t],r[t]=r[e],r[e]=i,n.updateItem(t,s),n.updateItem(e,h)}updateItem(t,e){let i=this.owner.items[this.indexMap[t]],n=i.style;n.left=`${e.left}px`,n.top=`${e.top}px`,i.style=n}}Neo.applyClassConfig(i);export{i as default};