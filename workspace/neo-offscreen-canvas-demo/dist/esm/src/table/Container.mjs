import e from"../container/Base.mjs";import t from"../util/ClassSystem.mjs";import o from"../util/Css.mjs";import r from"../util/Array.mjs";import s from"../selection/table/RowModel.mjs";import a from"../data/Store.mjs";import i from"./View.mjs";import*as n from"./header/_export.mjs";class l extends e{static getConfig(){return{className:"Neo.table.Container",ntype:"table-container",amountRows:20,columnDefaults:null,createRandomData:!1,cls:["neo-table-container"],columns_:[],headerToolbarConfig:null,headerToolbarId_:null,keys:{},layout:"base",scrollbarsCssApplied:!1,selectionModel_:null,showHeaderFilters_:!1,store_:null,useCustomScrollbars_:!0,viewConfig:null,viewId_:null,items:null,_vdom:{cls:["neo-table-wrapper"],cn:[{tag:"table",cn:[]}]}}}constructor(e){super(e);let t=this;t.headerToolbarId=Neo.getId("table-header-toolbar"),t.viewId=Neo.getId("table-view"),t.items=[{module:n.Toolbar,id:t.headerToolbarId,showHeaderFilters:t.showHeaderFilters,...t.headerToolbarConfig},{module:i,containerId:t.id,id:t.viewId,store:t.store,useRowRecordIds:!t.createRandomData,...t.viewConfig}],t.vdom.id=t.id+"wrapper",t.createColumns(t.columns)}afterSetSelectionModel(e,t){this.rendered&&e.register(this)}afterSetShowHeaderFilters(e,t){void 0!==t&&(Neo.getComponent(this.headerToolbarId).showHeaderFilters=e)}afterSetUseCustomScrollbars(e,t){!0===e&&(this.vdom.cls=r.union(this.vdom.cls,["neo-use-custom-scrollbar"]))}applyCustomScrollbarsCss(){let e=this,t=[];e.dockLeftMargin&&t.push("#"+e.id+"wrapper::-webkit-scrollbar-track:horizontal {margin-left: "+e.dockLeftMargin+"px;}"),e.dockRightMargin&&t.push("#"+e.id+"wrapper::-webkit-scrollbar-track:horizontal {margin-right: "+e.dockRightMargin+"px;}"),t.length>0&&o.insertRules(t),e.scrollbarsCssApplied=!0}beforeSetColumns(e,t){return this.configsApplied?this.createColumns(e):e}beforeSetHeaderToolbarId(e,t){return e||t}beforeSetSelectionModel(e,o){return o&&o.destroy(),t.beforeSetInstance(e,s)}beforeSetStore(e,o){if(o&&o.destroy(),e){let o=this;const r={filter:o.onStoreFilter,load:o.onStoreLoad,recordChange:o.onStoreRecordChange,scope:o};e instanceof a?(e.on(r),e.getCount()>0&&o.onStoreLoad(e.items)):e=t.beforeSetInstance(e,a,{listeners:r}),o.view&&(o.view.store=e)}return e}beforeSetViewId(e,t){return e||t}createColumns(e){let t=this,o=t.columnDefaults,r=t.store?.sorters;return e&&e.length||Neo.logError("Attempting to create a table.Container without defined columns",t.id),e.forEach((e=>{e.dock&&!e.width&&Neo.logError("Attempting to create a docked column without a defined width",e,t.id),o&&Neo.assignDefaults(e,o),r?.[0]&&e.dataField===r[0].property&&(e.isSorted=r[0].direction),e.listeners={sort:t.onSortColumn,scope:t}})),t.items[0].items=e,e}createRandomViewData(e){this.loadData(e)}createViewData(e){let t=this,o=t.items;o[1].createViewData(e),t.useCustomScrollbars&&!1===t.scrollbarsCssApplied&&t.applyCustomScrollbarsCss(),t.items=o}getVdomRoot(){return this.vdom.cn[0]}getView(){return Neo.getComponent(this.viewId)||Neo.get(this.viewId)}getVnodeRoot(){return this.vnode.childNodes[0]}loadData(e){let t=this,o=t.items[0].items.length;Neo.manager.Store.createRandomData([o,e]).then((e=>{t.createViewData(e)}))}onConstructed(){super.onConstructed();let e=this;e.selectionModel&&e.selectionModel.register(e),e.createRandomData&&setTimeout((()=>{e.createRandomViewData(e.amountRows)}),50)}onSortColumn(e){let t=this;t.store.sort(e),t.removeSortingCss(e.property),t.onStoreLoad(t.store.items)}onStoreFilter(){this.onStoreLoad(this.store.items)}onStoreLoad(e){let t,o=this;o.rendered?(o.createViewData(e),o.store.sorters.length<1&&o.removeSortingCss()):t=o.on("rendered",(()=>{o.un("rendered",t),setTimeout((()=>{o.createViewData(e)}),50)}))}onStoreRecordChange(e){Neo.getComponent(this.viewId).onStoreRecordChange(e)}removeSortingCss(e){this.items[0].items.forEach((t=>{t.dataField!==e&&t.removeSortingCss()}))}}Neo.applyClassConfig(l);export{l as default};