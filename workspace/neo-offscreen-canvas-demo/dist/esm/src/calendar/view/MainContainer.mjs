import e from"./calendars/Container.mjs";import t from"../../container/Base.mjs";import n from"../../component/DateSelector.mjs";import a from"../../util/Date.mjs";import o from"./calendars/EditContainer.mjs";import i from"./EditEventContainer.mjs";import r from"./MainContainerModel.mjs";import l from"../../container/Toolbar.mjs";const s=new Date;class d extends t{static getStaticConfig(){return{validViews:["day","week","month","year"]}}static getConfig(){return{className:"Neo.calendar.view.MainContainer",ntype:"calendar-maincontainer",activeView_:"week",baseFontSize_:null,bind:{currentDate:{twoWay:!0,value:e=>e.currentDate},endTime:{twoWay:!0,value:e=>e.endTime},locale:{twoWay:!0,value:e=>e.locale},minimumEventDuration:{twoWay:!0,value:e=>e.minimumEventDuration},scrollNewYearFromTop:{twoWay:!0,value:e=>e.scrollNewYearFromTop},showWeekends:{twoWay:!0,value:e=>e.showWeekends},startTime:{twoWay:!0,value:e=>e.startTime},timeFormat:{twoWay:!0,value:e=>e.timeFormat},weekStartDay:{twoWay:!0,value:e=>e.weekStartDay}},calendarsContainer:null,calendarStoreConfig_:null,cls:["neo-calendar-maincontainer","neo-container"],colorStoreConfig_:null,currentDate_:s,dateSelector:null,dateSelectorConfig:null,dayComponent:null,dayComponentConfig:null,editCalendarContainer_:null,editCalendarContainerConfig:null,editEventContainer_:null,editEventContainerConfig:null,endTime_:"24:00",eventStoreConfig_:null,layout:{ntype:"vbox",align:"stretch"},locale_:Neo.config.locale,minimumEventDuration_:30,model:r,monthComponent:null,monthComponentConfig:null,removeInactiveCards:!0,scrollNewYearFromTop_:!1,settingsContainerConfig:null,settingsContainerWidth:310,settingsExpanded_:!1,showWeekends_:!0,sideBarExpanded_:!0,sideBarWidth:220,startTime_:"00:00",timeFormat_:{hour:"2-digit",minute:"2-digit"},useSettingsContainer_:!0,views_:["day","week","month","year"],weekComponent:null,weekComponentConfig:null,weekStartDay_:0,yearComponent:null,yearComponentConfig:null}}constructor(e){super(e);let t=this;t.createItemsContent(),!t.sideBarExpanded&&t.afterSetSideBarExpanded(!1,!0)}afterSetActiveView(e,t){if(void 0!==t){let t=this;t.items[1].items[1].layout.activeIndex=t.views.indexOf(e),t.items[0].items[1].items.forEach((t=>{"mainViews"===t.toggleGroup&&(t.pressed=t.value===e)}))}}afterSetBaseFontSize(e,t){if(void 0!==t){let t=this.style||{};e?t.fontSize=`${e}px`:delete t.fontSize,this.style=t}}afterSetSettingsExpanded(e,t){if(Neo.isBoolean(t)){let t=this,n=t.items[1].items[2];e?n?n.expand():t.createSettingsContainer(!0).then((()=>{setTimeout((()=>{t.items[1].items[2].expand()}),50)})):n.collapse(t.settingsContainerWidth)}}afterSetSideBarExpanded(e,t){if(void 0!==t){let t,n=this,a=n.items[1].items[0],o=a.style||{};e?(delete a.vdom.removeDom,n.promiseVdomUpdate().then((()=>{a.mounted=!0,setTimeout((()=>{o.marginLeft="0px",a.style=o}),50)}))):(o.marginLeft=`-${n.sideBarWidth}px`,a._style=o,a._vdom.style=o,n.promiseVdomUpdate().then((()=>{setTimeout((()=>{t=a.vdom,t.removeDom=!0,a.vdom=t,a.mounted=!1}),400)})))}}afterSetUseSettingsContainer(e,t){let n=this;e?(n.settingsExpanded&&n.createSettingsContainer(!1),setTimeout((()=>{n.items[0].items[1].add({handler:n.toggleSettings.bind(n),iconCls:"fa fa-cog",style:{marginLeft:"10px"}})}),10)):!1===e&&t&&(n.items[1].removeLast(),n.items[0].items[1].removeLast())}beforeGetEditCalendarContainer(e){if(!e){let t=this;t._editCalendarContainer=e=Neo.create({module:o,appName:t.appName,model:{parent:t.getModel()},owner:t,width:250,...t.editCalendarContainerConfig})}return e}beforeGetEditEventContainer(e){if(!e){let t=this;t._editEventContainer=e=Neo.create({module:i,appName:t.appName,model:{parent:t.getModel()},owner:t,width:250,...t.editEventContainerConfig})}return e}beforeSetActiveView(e,t){return this.beforeSetEnumValue(e,t,"activeView","validViews")}beforeSetViews(e,t){let n=this.getStaticConfig("validViews");return e.forEach((e=>{if(!n.includes(e))return console.error(e,"is not a valid entry for views. Stick to:",n),t})),e}changeActiveView(e){this.activeView=e}createHeaderItems(){let e=this;return[{module:l,cls:["neo-calendar-header-toolbar","neo-left","neo-toolbar"],width:e.sideBarWidth,items:[{handler:e.toggleSidebar.bind(e),iconCls:"fa fa-bars"},"->",{handler:e.onPreviousIntervalButtonClick.bind(e),iconCls:"fa fa-chevron-left"},{handler:e.onTodayButtonClick.bind(e),height:24,text:"Today"},{handler:e.onNextIntervalButtonClick.bind(e),iconCls:"fa fa-chevron-right"}]},{module:l,cls:["neo-calendar-header-toolbar","neo-toolbar"],items:["->",...e.createViewHeaderButtons()]}]}createItemsContent(){let o=this;o.calendarsContainer=Neo.create({module:e,flex:1,parentId:o.id,owner:o}),o.dateSelector=Neo.create({module:n,appName:o.appName,flex:"none",height:o.sideBarWidth,listeners:{change:o.onDateSelectorChange,scope:o},parentId:o.id,value:a.convertToyyyymmdd(o.currentDate),bind:{locale:e=>e.locale,scrollNewYearFromTop:e=>e.scrollNewYearFromTop,showWeekends:e=>e.showWeekends,value:e=>a.convertToyyyymmdd(e.currentDate),weekStartDay:e=>e.weekStartDay},...o.dateSelectorConfig}),o.items=[{module:t,flex:"none",layout:{ntype:"hbox",align:"stretch"},items:o.createHeaderItems()},{module:t,flex:1,layout:{ntype:"hbox",align:"stretch"},items:[{module:t,cls:["neo-calendar-sidebar","neo-container"],layout:{ntype:"vbox",align:"stretch"},width:o.sideBarWidth,items:[o.dateSelector,o.calendarsContainer]},{module:t,flex:1,items:o.createViews(),listeners:{cardLoaded:o.onCardLoaded,scope:o},layout:{ntype:"card",activeIndex:o.views.indexOf(o.activeView),removeInactiveCards:o.removeInactiveCards}}]}]}createSettingsContainer(e){let t=this;return import("./SettingsContainer.mjs").then((n=>{t.items[1].add({module:n.default,collapsed:e,removeInactiveCards:t.removeInactiveCards,style:{marginRight:e?`-${t.settingsContainerWidth}px`:"0"},width:t.settingsContainerWidth,...t.settingsContainerConfig})}))}createViewHeaderButtons(){let e=this,t=e.views.indexOf(e.activeView),n=[];return e.views.forEach(((a,o)=>{n.push({handler:e.changeActiveView.bind(e,a),height:24,pressed:t===o,text:Neo.capitalize(a),toggleGroup:"mainViews",value:a})})),n}createViews(){let e,t=this,n=[],a={appName:t.appName,owner:t,parentId:t.id},o={day:{module:()=>import("./DayComponent.mjs"),flag:"day",style:{padding:"20px"},...a,...t.dayComponentConfig},month:{module:()=>import("./month/Component.mjs"),flag:"month",...a,...t.monthComponentConfig},week:{module:()=>import("./week/Component.mjs"),flag:"week",minimumEventDuration:t.minimumEventDuration,...a,...t.weekComponentConfig},year:{module:()=>import("./YearComponent.mjs"),flag:"year",...a,...t.yearComponentConfig}};return t.views.forEach((a=>{t[`${a}Component`]=e=o[a],n.push(e)})),n}onCardLoaded(e){this[`${e.item.flag}Component`]=e.item,this.fire("cardLoaded",{item:e.item})}onDateSelectorChange(e){void 0!==e.oldValue&&this.getModel().setData("currentDate",new Date(`${e.value}T00:00:00`))}onNextIntervalButtonClick(e){this.switchInterval(1)}onPreviousIntervalButtonClick(e){this.switchInterval(-1)}onTodayButtonClick(e){this.currentDate=s}toggleSettings(){this.settingsExpanded=!this.settingsExpanded}toggleSidebar(){this.sideBarExpanded=!this.sideBarExpanded}switchInterval(e){let t=this,n=t.currentDate;({day:()=>{n.setDate(n.getDate()+e)},month:()=>{n.setMonth(n.getMonth()+e)},week:()=>{n.setDate(n.getDate()+7*e)},year:()=>{n.setFullYear(n.getFullYear()+e)}})[t.activeView](),t.currentDate=n}}Neo.applyClassConfig(d);export{d as default};