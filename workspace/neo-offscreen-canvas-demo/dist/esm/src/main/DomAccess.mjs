import e from"../core/Base.mjs";import t from"./mixin/DeltaUpdates.mjs";import o from"../core/Observable.mjs";class r extends e{static getConfig(){return{className:"Neo.main.DomAccess",countDeltas:0,countDeltasPer250ms:0,countUpdates:0,mixins:[t,o],remote:{app:["addScript","applyBodyCls","execCommand","focus","getAttributes","getBoundingClientRect","scrollBy","scrollIntoView","scrollTo","scrollToTableRow","selectNode","setBodyCls","setStyle","windowScrollTo"]},singleton:!0,voidAttributes:["checked","required"]}}constructor(e){super(e);let t,o=this;Neo.config.renderCountDeltas&&setInterval((()=>{t=document.getElementById("neo-delta-updates"),t&&(t.innerHTML=String(4*o.countDeltasPer250ms)),o.countDeltasPer250ms=0}),250)}addScript(e){const t=document.createElement("script");e.hasOwnProperty("async")||(e.async=!0),Object.assign(t,e),document.head.appendChild(t)}applyBodyCls(e){const t=e.cls||[];document.body.classList.add(...t)}execCommand(e){return document.execCommand(e.command),e}focus(e){let t=this.getElement(e.id);return t&&(t.focus(),Neo.isNumber(t.selectionStart)&&(t.selectionStart=t.selectionEnd=t.value.length)),{id:e.id}}getAttributes(e){let t;if(Array.isArray(e.id))t=[],e.id.forEach((o=>{t.push(this.getAttributes({attributes:e.attributes,id:o}))}));else{let o=this.getElementOrBody(e.id);t={},o&&(Array.isArray(e.attributes)||(e.attributes=[e.attributes],e.attributes.forEach((e=>{t[e]=o[e]}))))}return t}getBoundingClientRect(e){let t;if(Array.isArray(e.id))t=[],e.id.forEach((e=>{t.push(this.getBoundingClientRect({id:e}))}));else{let o=this.getElementOrBody(e.id),r={};t={},o&&(r=o.getBoundingClientRect(),Object.assign(t,{bottom:r.bottom,height:r.height,left:r.left,right:r.right,top:r.top,width:r.width,x:r.x,y:r.y}))}return t}getElement(e){return Neo.config.useDomIds?document.getElementById(e):document.querySelector(`[data-neo-id='${e}']`)}getElementOrBody(e="document.body"){return"body"===e||"document.body"===e?document.body:this.getElement(e)}loadScript(e,t=!0){let o;return new Promise(((r,s)=>{o=document.createElement("script"),Object.assign(o,{async:t,onerror:s,onload:r,src:e}),document.head.appendChild(o)}))}loadStylesheet(e){let t;return new Promise(((o,r)=>{t=document.createElement("link"),Object.assign(t,{href:e,onerror:r,onload:o,rel:"stylesheet",type:"text/css"}),document.head.appendChild(t)}))}onDomContentLoaded(){Neo.config.applyBodyCls&&this.applyBodyCls({cls:["neo-body"]})}onGetOffscreenCanvas(e){let t=this.getElement(e.nodeId).transferControlToOffscreen();e.offscreen=t,Neo.worker.Manager.sendMessage(e.origin,{action:"reply",data:e,replyId:e.id,success:!0},[t])}onReadDom(e){let t,o,r=e.attributes||[],s=e.functions||[],n=e.styles||[],i=e.vnodeId,l={},a={},d={},c=i?this.getElement(i):null;r.forEach((e=>{l[e]=c[e]})),s.forEach(((e,r)=>{Neo.isObject(e)?(e.params=e.params||[],e.paramIsDomNode=e.paramIsDomNode||[],o=e.scope?document[e.scope]:c,e.params.forEach(((t,o)=>{!0===e.paramIsDomNode[o]&&(e.params[o]=this.getElement(e.params[o]))})),t=e.returnFnName?e.returnFnName:r,a[t]=o[e.fn](...e.params),e.returnValue&&(a[t]=a[t][e.returnValue])):a[e]=c[e]()})),n.forEach((e=>{d[e]=c.style[e]})),Object.assign(e,{attributes:l,functions:a,styles:d}),Neo.worker.Manager.sendMessage(e.origin,{action:"reply",data:e,replyId:e.id,success:!0})}read(e){"function"==typeof e&&e()}scrollBy(e){let t=this.getElement(e.id);return t&&(t[`scroll${Neo.capitalize(e.direction)}`]+=e.value),{id:e.id}}scrollIntoView(e){let t=this.getElement(e.id);return t&&t.scrollIntoView({behavior:e.behavior||"smooth",block:e.block||"start",inline:e.inline||"nearest"}),{id:e.id}}scrollTo(e){let t=this.getElement(e.id);return t&&(t[`scroll${Neo.capitalize(e.direction)}`]=e.value),{id:e.id}}scrollToTableRow(e){let t=this.getElement(e.id);if(t){let o=t.parentNode.parentNode,r=o.parentNode,s=o.getBoundingClientRect().top,n=t.getBoundingClientRect().top;r.scrollTo({top:n-s-(e.hasOwnProperty("offset")?e.offset:34),behavior:e.behavior||"smooth"})}return{id:e.id}}selectNode(e){let t=this.getElement(e.id),o=Neo.isNumber(e.start)||0,r=Neo.isNumber(e.end)||99999;return t&&(t.select(),t.setSelectionRange(o,r)),{id:e.id}}setBodyCls(e){document.body.classList.remove(...e.remove||[]),document.body.classList.add(...e.add||[])}setStyle(e){let t=this.getElementOrBody(e.id);return t&&Object.entries(e.style).forEach((([e,o])=>{Neo.isString(o)&&o.includes("!important")?(o=o.replace("!important","").trim(),t.style.setProperty(Neo.decamel(e),o,"important")):t.style[Neo.decamel(e)]=o})),{id:e.id}}windowScrollTo(e){window.scrollTo({behavior:e.behavior||"smooth",left:e.left||0,top:e.top||0})}write(e){this.du_insertNode({index:e.parentIndex,outerHTML:e.html||e.outerHTML,parentId:e.parentId})}}Neo.applyClassConfig(r);let s=Neo.create(r);Neo.applyToGlobalNs(s);export default s;