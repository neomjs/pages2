import e from"./Base.mjs";import t from"../../DomEvents.mjs";let n=!1;window.addEventListener("touchmove",(e=>{n&&e.cancelable&&e.preventDefault()}),{cancelable:!0,passive:!1});class o extends e{static getConfig(){return{className:"Neo.main.draggable.sensor.Touch",delay:200,minDistance:0,pageX:null,pageY:null,tapTimeout:null,touchStartTime:0}}constructor(e){super(e),Neo.bindMethods(this,["onDistanceChange","onTouchEnd","onTouchMove","onTouchStart","startDrag"])}attach(){document.addEventListener("touchstart",this.onTouchStart)}detach(){document.removeEventListener("touchstart",this.onTouchStart)}onDistanceChange(e){let n=this;if(n.currentElement){const{pageX:o,pageY:a}=t.getTouchCoords(e),r=t.getTouchCoords(n.startEvent),c=Date.now()-n.touchStartTime,s=t.getDistance(r.pageX,r.pageY,o,a)||0;Object.assign(n,{pageX:o,pageY:a}),c>=n.delay&&s>=n.minDistance&&(clearTimeout(n.tapTimeout),document.removeEventListener("touchmove",n.onDistanceChange),n.startDrag())}}onTouchEnd(e){n=!1;let o=this;if(clearTimeout(o.tapTimeout),document.removeEventListener("dragstart",a),document.removeEventListener("touchcancel",o.onTouchEnd),document.removeEventListener("touchend",o.onTouchEnd),document.removeEventListener("touchmove",o.onDistanceChange),o.dragging){const{pageX:n,pageY:r}=t.getTouchCoords(e);let c=o.currentElement,s=document.elementFromPoint(n-window.scrollX,r-window.scrollY);e.preventDefault(),o.trigger(c,{clientX:n,clientY:r,element:c,eventPath:t.getPathFromElement(s),originalEvent:e,path:o.startEvent.path||o.startEvent.composedPath(),target:s,type:"drag:end"}),document.removeEventListener("contextmenu",a,!0),document.removeEventListener("touchmove",o.onTouchMove),Object.assign(o,{currentElement:null,dragging:!1,startEvent:null})}o.dragging=!1}onTouchMove(e){let n=this;if(n.dragging){const{pageX:o,pageY:a}=t.getTouchCoords(e);let r=n.currentElement,c=document.elementFromPoint(o-window.scrollX,a-window.scrollY);n.trigger(r,{clientX:o,clientY:a,element:r,eventPath:t.getPathFromElement(c),originalEvent:e,path:n.startEvent.path||n.startEvent.composedPath(),target:c,type:"drag:move"})}}onTouchStart(e){let n=this,o=t.testPathInclusion(e,n.dragTargetClasses);if(o){const{pageX:r,pageY:c}=t.getTouchCoords(e);e.path||(e.path=e.composedPath()),Object.assign(n,{currentElement:o.node,pageX:r,pageY:c,startEvent:e,touchStartTime:Date.now()}),document.addEventListener("dragstart",a),document.addEventListener("touchcancel",n.onTouchEnd),document.addEventListener("touchend",n.onTouchEnd),document.addEventListener("touchmove",n.onDistanceChange,{cancelable:!0}),n.tapTimeout=setTimeout((()=>{n.onDistanceChange({touches:[{pageX:n.pageX,pageY:n.pageY}]})}),n.delay)}}startDrag(){let e=this,o=e.currentElement,r=e.startEvent,c=t.getTouchCoords(e.startEvent);e.trigger(o,{clientX:c.pageX,clientY:c.pageY,element:o,originalEvent:r,path:r.path||r.composedPath(),target:r.target,type:"drag:start"}),e.dragging=!0,e.dragging&&(document.addEventListener("contextmenu",a,!0),document.addEventListener("touchmove",e.onTouchMove)),n=e.dragging}}function a(e){e.preventDefault(),e.stopPropagation()}Neo.applyClassConfig(o);export{o as default};