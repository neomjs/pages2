import e from"../../core/Base.mjs";import t from"../DomAccess.mjs";import o from"../DomEvents.mjs";class l extends e{static getConfig(){return{className:"Neo.main.addon.DragDrop",alwaysFireDragMove:!1,bodyCursorStyle:null,boundaryContainerRect:null,clientX:0,clientY:0,dragElementRootId:null,dragProxyCls:"neo-dragproxy",dragProxyElement:null,dragProxyRect:null,dragZoneId:null,dropZoneIdentifier:null,initialScrollLeft:0,initialScrollTop:0,moveHorizontal:!0,moveVertical:!0,offsetX:0,offsetY:0,remote:{app:["setConfigs","setDragProxyElement"]},scrollContainerElement:null,scrollContainerRect:null,scrollFactorLeft:1,scrollFactorTop:1,singleton:!0}}constructor(e){super(e);let t=this,l=[];o.on({mouseEnter:t.onMouseEnter,mouseLeave:t.onMouseLeave,scope:t}),t.addGlobalEventListeners(),Neo.config.hasTouchEvents?l.push(import("../draggable/sensor/Touch.mjs")):l.push(import("../draggable/sensor/Mouse.mjs")),Promise.all(l).then((e=>{Neo.create({module:e[0].default})}))}addGlobalEventListeners(){let e=this;document.addEventListener("drag:end",e.onDragEnd.bind(e),!0),document.addEventListener("drag:move",e.onDragMove.bind(e),!0),document.addEventListener("drag:start",e.onDragStart.bind(e),!0)}getEventData(e){const t=e.path||e.composedPath(),l={...o.getEventData(e.detail.originalEvent),clientX:e.detail.clientX,clientY:e.detail.clientY};return e.detail.eventPath?l.targetPath=e.detail.eventPath.map((e=>o.getTargetData(e))):l.targetPath=l.path,l.path=t.map((e=>o.getTargetData(e))),l}onDragEnd(e){let l=this,n=l.getEventData(e),r=l.pathIncludesDropZone(n.targetPath);t.setBodyCls({remove:["neo-unselectable"]}),l.bodyCursorStyle&&t.setStyle({id:"document.body",style:{cursor:null}}),o.sendMessageToApp({...n,isDrop:r,offsetX:l.offsetX,offsetY:l.offsetY,type:"drag:end"}),r&&o.sendMessageToApp({...o.getMouseEventData(e.detail.originalEvent),dragZoneId:l.dragZoneId,type:"drop"}),Object.assign(l,{alwaysFireDragMove:!1,bodyCursorStyle:null,boundaryContainerRect:null,dragElementRootId:null,dragElementRootRect:null,dragProxyCls:"neo-dragproxy",dragProxyElement:null,dragZoneId:null,dropZoneIdentifier:null,initialScrollLeft:0,initialScrollTop:0,moveHorizontal:!0,moveVertical:!0,scrollContainerElement:null,scrollContainerRect:null,setScrollFactorLeft:1,scrollFactorTop:1})}onDragMove(e){let t,l,n,r=this,a=r.dragProxyRect,i=r.boundaryContainerRect;r.scrollContainerElement&&(t=r.scrollContainer({clientX:e.detail.clientX,clientY:e.detail.clientY}),e.detail.clientX=t.clientX,e.detail.clientY=t.clientY),r.dragProxyElement&&(l=e.detail.clientX-r.offsetX,n=e.detail.clientY-r.offsetY,i&&(l<i.left?l=i.left:l>i.right-a.width&&(l=i.right-a.width),n<i.top?n=i.top:n>i.bottom-a.height&&(n=i.bottom-a.height)),r.moveHorizontal||(l=r.dragProxyRect.x),r.dragProxyElement.style.left=`${l}px`,r.moveVertical||(n=r.dragProxyRect.y),r.dragProxyElement.style.top=`${n}px`),r.dragProxyElement&&!r.alwaysFireDragMove||o.sendMessageToApp({...r.getEventData(e),offsetX:r.offsetX,offsetY:r.offsetY,type:"drag:move"})}onDragStart(e){let l=e.target.getBoundingClientRect();t.setBodyCls({add:["neo-unselectable"]}),Object.assign(this,{dragProxyRect:l,offsetX:e.detail.clientX-l.left,offsetY:e.detail.clientY-l.top}),o.sendMessageToApp({...this.getEventData(e),type:"drag:start"})}onMouseEnter(e){let t=this;t.pathIncludesDropZone(e.path)&&o.sendMessageToApp({...e,dragZoneId:t.dragZoneId,type:"drop:enter"})}onMouseLeave(e){let t=this;t.pathIncludesDropZone(e.path)&&o.sendMessageToApp({...e,dragZoneId:t.dragZoneId,type:"drop:leave"})}pathIncludesDropZone(e){let t,o,l=!0,n=this.dropZoneIdentifier;if(n){t=n.cls,o=n.ids;for(const n of e){if(t){l=!1;for(const e of n.cls)if(t.includes(e)){l=!0;break}}if(l&&o&&!o.includes(n.id)&&(l=!1),l)return!0}}return!1}scrollContainer(e){let t=this,o=e.clientX-t.clientX,l=e.clientY-t.clientY,n=t.scrollContainerElement,r=250,a=t.scrollContainerRect;return t.clientX=e.clientX,t.clientY=e.clientY,(o<0&&e.clientX<a.left+r||o>0&&e.clientX>a.right-r)&&(n.scrollLeft+=o*t.scrollFactorLeft),(l<0&&e.clientY<a.top+r||l>0&&e.clientY>a.bottom-r)&&(n.scrollTop+=l*t.scrollFactorTop),{clientX:t.clientX+n.scrollLeft-t.initialScrollLeft,clientY:t.clientY+n.scrollTop-t.initialScrollTop}}setConfigs(e){let o,l=this;delete e.appName,e.boundaryContainerId&&(o=t.getElementOrBody(e.boundaryContainerId),l.boundaryContainerRect=o.getBoundingClientRect()),delete e.boundaryContainerId,e.scrollContainerId&&(o=t.getElementOrBody(e.scrollContainerId),Object.assign(l,{scrollContainerElement:o,scrollContainerRect:o.getBoundingClientRect(),initialScrollLeft:o.scrollLeft,initialScrollTop:o.scrollTop})),delete e.scrollContainerId,Object.entries(e).forEach((([e,t])=>{l.hasOwnProperty(e)?l[e]=t:console.error("unknown key passed inside setConfigs()",e)})),l.bodyCursorStyle&&t.setStyle({id:"document.body",style:{cursor:l.bodyCursorStyle}})}setDragProxyElement(e){this.dragProxyElement=document.getElementById(e.id)}}Neo.applyClassConfig(l);let n=Neo.create(l);Neo.applyToGlobalNs(n);export default n;