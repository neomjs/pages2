import e from"../../core/Base.mjs";class t extends e{static getConfig(){return{className:"Neo.main.mixin.DeltaUpdates"}}du_focusNode(e){this.getElement(e.id).focus()}du_insertNode(e){let t,n=e.index,d=this.getElementOrBody(e.parentId),o=d.childNodes.length,r=0,i=n,s=!1;if(o<=20&&"TBODY"!==d.nodeName)for(;r<o;r++)8===d.childNodes[r].nodeType&&(r<i&&i++,s=!0);if(s)t=this.htmlStringToElement(e.outerHTML),o>0&&o>i?d.insertBefore(t,d.childNodes[i]):d.appendChild(t);else{if(o=d.children.length,n>0&&n>=o)return void d.insertAdjacentHTML("beforeend",e.outerHTML);o>0&&o>n?d.children[n].insertAdjacentHTML("beforebegin",e.outerHTML):o>0?d.children[o-1].insertAdjacentHTML("afterend",e.outerHTML):d.insertAdjacentHTML("beforeend",e.outerHTML)}}du_moveNode(e){let t=e.index,n=this.getElement(e.id),d=this.getElement(e.parentId);t>=d.children.length?d.appendChild(n):n&&d.children[t].id!==e.id&&d.insertBefore(n,d.children[t])}du_removeNode(e){let t,n,d=this.getElement(e.id);d?d.parentNode.removeChild(d):(d=this.getElementOrBody(e.parentId),d&&(n=`\x3c!-- ${e.id} --\x3e`,t=new RegExp(n+"[\\s\\S]*?\x3c!-- /neo-vtext --\x3e"),d.innerHTML=d.innerHTML.replace(t,"")))}du_replaceChild(e){let t=this;t.getElement(e.parentId).replaceChild(t.getElement(e.toId),t.getElement(e.fromId))}du_setTextContent(e){this.getElement(e.id).textContent=e.value}du_updateNode(e){let t=this.getElementOrBody(e.id);t?Object.entries(e).forEach((([e,n])=>{switch(e){case"attributes":Object.entries(n).forEach((([e,n])=>{this.voidAttributes.includes(e)?t[e]="true"===n:null===n||""===n?"value"===e?t[e]="":t.removeAttribute(e):"id"===e?t[Neo.config.useDomIds?"id":"data-neo-id"]=n:t[e]=("spellcheck"!==e||"false"!==n)&&n}));break;case"cls":t.classList.add(...n.add||[]),t.classList.remove(...n.remove||[]);break;case"innerHTML":t.innerHTML=n||"";break;case"outerHTML":t.outerHTML=n||"";break;case"style":Neo.isObject(n)&&Object.entries(n).forEach((([e,n])=>{Neo.isString(n)&&n.includes("!important")?(n=n.replace("!important","").trim(),t.style.setProperty(Neo.decamel(e),n,"important")):t.style[Neo.decamel(e)]=n}))}})):console.warn("du_updateNode: node not found for id",e.id)}du_updateVtext(e){let t=this.getElement(e.parentId),n=t.innerHTML,d=`\x3c!-- ${e.id} --\x3e`,o=new RegExp(d+"[\\s\\S]*?\x3c!-- /neo-vtext --\x3e");t.innerHTML=n.replace(o,e.value)}htmlStringToElement(e){const t=document.createElement("template");return t.innerHTML=e,t.content}update(e){let t,n=this,d=e.deltas,o=0;d=Array.isArray(d)?d:[d],t=d.length,Neo.config.logDeltaUpdates&&t>0&&(n.countDeltas+=t,n.countUpdates++,console.log("update "+n.countUpdates,"total deltas ",n.countDeltas,Neo.clone(e,!0))),Neo.config.renderCountDeltas&&t>0&&(n.countDeltasPer250ms+=t);const r={focusNode:n.du_focusNode,insertNode:n.du_insertNode,moveNode:n.du_moveNode,removeNode:n.du_removeNode,replaceChild:n.du_replaceChild,setTextContent:n.du_setTextContent,updateVtext:n.du_updateVtext,default:n.du_updateNode};for(;o<t;o++)(r[d[o].action]||r.default).call(n,d[o]);Neo.worker.Manager.sendMessage(e.origin||"app",{action:"reply",replyId:e.id,success:!0})}}Neo.applyClassConfig(t);export{t as default};