import e from"./Base.mjs";import t from"./trigger/Base.mjs";import r from"./trigger/Clear.mjs";import i from"../../util/Array.mjs";import l from"../../util/VDom.mjs";import n from"../../util/VNode.mjs";class o extends e{static getStaticConfig(){return{autoCapitalizeValues:["characters","none","on","off","sentences","words"],labelPositions:["bottom","inline","left","right","top"]}}static getConfig(){return{className:"Neo.form.field.Text",ntype:"textfield",autoCapitalize_:"off",autoComplete_:!1,centerBorderElWidth:null,clearable_:!0,clearToOriginalValue_:!1,cls:["neo-textfield"],hideLabel_:!1,inputType_:"text",labelPosition_:"left",labelText_:"LabelText",labelWidth_:150,placeholderText_:null,required_:!1,spellCheck_:!1,triggers_:null,_vdom:{cn:[{tag:"label",cls:["neo-textfield-label"],style:{}},{tag:"input",cls:["neo-textfield-input"],flag:"neo-real-input",style:{}}]}}}constructor(e){super(e);let t=this,r=t.domListeners;r.push({input:t.onInputValueChange,scope:t}),t.domListeners=r}afterSetAppName(e,t){super.afterSetAppName(e,t),e&&this.triggers?.forEach((t=>{t.appName=e}))}afterSetAutoCapitalize(e,t){this.changeInputElKey("autocapitalize","off"===e||"none"===e?null:e)}afterSetAutoComplete(e,t){this.changeInputElKey("autocomplete",e?null:"off")}afterSetClearable(e,t){let i,l=this;e?(i=l.triggers||[],i.unshift(r),l.triggers=i):l.removeTrigger("clear")}afterSetClearToOriginalValue(e,t){this.fire("changeClearToOriginalValue",{oldValue:t,value:e})}afterSetHideLabel(e,t){let r=this,i=r.vdom;i.cn[0].removeDom=e,r._vdom=i,r.updateInputWidth()}afterSetId(e,t){let r=this,i=r.getInputEl(),l=r.getInputElId(),n=r.getLabelEl();i.id=l,n.id=r.getLabelId(),n.for=l,super.afterSetId(e,t)}afterSetInputType(e,t){this.changeInputElKey("type",e)}afterSetLabelPosition(e,t){let r,l,n,o=this,a=o.cls;i.remove(a,"label-"+t),i.add(a,"label-"+e),o["inline"===t||"inline"===e?"_cls":"cls"]=a,"inline"===t?(n=o.vdom,n.cn[0]=o.getLabelEl(),n.cn[0].width=o.labelWidth,o._vdom=n,o.updateInputWidth()):"inline"===e&&(r=["neo-center-border"],l=o.isEmpty(),n=o.vdom,l||r.push("neo-float-above"),delete n.cn[0].width,n.cn[0]={cls:["neo-label-wrapper"],cn:[{cls:["neo-left-border"]},{cls:r,cn:[n.cn[0]]},{cls:["neo-right-border"]}]},o._vdom=n,o.updateInputWidth(),l||setTimeout((()=>{o.updateCenterBorderElWidth(!1)}),20))}afterSetLabelText(e,t){let r=this,i=r.isEmpty(),l=r.vdom;r.getLabelEl().innerHTML=e,r.hideLabel?r._vdom=l:"inline"===r.labelPosition?(i||delete r.getCenterBorderEl().width,r.promiseVdomUpdate(l).then((()=>{r.updateCenterBorderElWidth(i)}))):r.vdom=l}afterSetLabelWidth(e,t){if("inline"!==this.labelPosition){let t=this,r=t.vdom;r.cn[0].width=e,t._vdom=r,!t.hideLabel&&t.updateInputWidth()}}afterSetMounted(e,t){super.afterSetMounted(e,t);let r=this;if(void 0!==t){let t=r.triggers||[],i=0,l=t.length;for(;i<l;i++)t[i].vdom.removeDom||(t[i].mounted=e);"inline"===r.labelPosition&&(e?r.updateCenterBorderElWidth():delete r.getCenterBorderEl().width)}}afterSetPlaceholderText(e,t){this.changeInputElKey("placeholder",""===e?null:e)}afterSetRequired(e,t){this.changeInputElKey("required",e||null)}afterSetSpellCheck(e,t){this.changeInputElKey("spellcheck",Neo.isBoolean(e)?e:null)}afterSetTriggers(e,t){let r,i=this,l=i.vdom,n=l.cn[1],o=[],a=[];t&&t.forEach((e=>{i.getTrigger(e.type)||e.destroy()})),e.length>0?(e.forEach((e=>{"start"===e.align?o.push(e):a.push(e)})),a.sort(((e,t)=>t.weight-e.weight)),o.sort(((e,t)=>e.weight-t.weight)),a=a.map((e=>e.vdom)),o=o.map((e=>e.vdom)),"input"===n.tag?(l.cn[1]={cls:["neo-input-wrapper"],cn:[...o,n,...a],id:i.getInputWrapperId(),width:n.width},delete n.width):n.cn=[...o,i.getInputEl(),...a]):"input"!==n.tag&&(r=n.width,l.cn[1]=i.getInputEl(),l.cn[1].width=r),i.promiseVdomUpdate().then((()=>{i.updateTriggerVnodes()}))}afterSetValue(e,t){let r=this,l=r.vdom;r.getInputEl().value=e,!!e!=!!t&&i[e&&e.toString().length>0?"add":"remove"](r._cls,"neo-has-content"),i[r.originalConfig.value!==e?"add":"remove"](r._cls,"neo-is-dirty"),r.vdom=l,super.afterSetValue(e,t)}afterSetWidth(e,t){super.afterSetWidth(e,t),this.updateInputWidth()}beforeGetTriggers(e){return Array.isArray(e)?[...e]:e}beforeSetAutoCapitalize(e,t){return this.beforeSetEnumValue(e,t,"autoCapitalize","autoCapitalizeValues")}beforeSetLabelPosition(e,t){return this.beforeSetEnumValue(e,t,"labelPosition")}beforeSetTriggers(e,r){e?Array.isArray(e)||(e=[e]):e=[];let i=this;return e.forEach(((r,l)=>{r.isClass?e[l]=Neo.create(r,{appName:i.appName,id:i.getTriggerId(r.prototype.type),field:i}):r instanceof t||(r.module||r.ntype||(r.ntype="trigger"),r.module&&(r.className=r.module.prototype.className,r.id=i.getTriggerId(r.module.prototype.type)),e[l]=Neo[r.className?"create":"ntype"]({...r,appName:i.appName,field:i}))})),e}changeInputElKey(e,t){let r=this,i=r.vdom;t||Neo.isBoolean(t)||0===t?r.getInputEl()[e]=t:delete r.getInputEl()[e],r.vdom=i}clear(){let e=this;e.value=e.clearToOriginalValue?e.originalConfig.value:null,e.fire("clear")}focus(e=this.id){super.focus(this.getInputElId())}getCenterBorderEl(){let e=l.findVdomChild(this.vdom,{cls:"neo-center-border"});return e?.vdom}getInputEl(){let e=l.findVdomChild(this.vdom,{flag:"neo-real-input"});return e?.vdom}getInputElId(){return`${this.id}__input`}getInputWidth(){let e=this,t=e.hideLabel||"bottom"===e.labelPosition||"inline"===e.labelPosition||"top"===e.labelPosition?0:e.labelWidth,r=e.width;return t&&r?parseInt(r)-parseInt(t):r||null}getInputWrapperId(){return`${this.id}__input-wrapper`}getLabelEl(){let e=l.findVdomChild(this.vdom,{tag:"label"});return e?.vdom}getLabelId(){return`${this.id}__label`}getTrigger(e){let t=this.triggers||[],r=0,i=t.length;for(;r<i;r++)if(t[r].type===e)return t[r];return null}getTriggerById(e){let t=this.triggers||[],r=0,i=t.length;for(;r<i;r++)if(t[r].id===e)return t[r];return null}getTriggerId(e){return this.id+"-trigger-"+e}hasTrigger(e){let t=this.triggers||[],r=0,i=t.length;for(;r<i;r++)if(t[r].type===e)return!0;return!1}isEmpty(){return!(this.value?.toString().length>0)}isValid(){let e=this;return!(e.required&&(!e.value||e.value?.length<1))&&super.isValid()}mergeConfig(...e){let t=super.mergeConfig(...e),r=t.triggers||this.triggers;return this[r?"triggers":"_triggers"]=r,delete t.triggers,t}onFocusEnter(e){let t,r=this,l=r.cls;i.add(l,"neo-focus"),r.cls=l,"inline"===r.labelPosition&&(r.centerBorderElWidth?(t=r.vdom,r.getCenterBorderEl().width=r.centerBorderElWidth,r.vdom=t):r.updateCenterBorderElWidth(!1))}onFocusLeave(e){let t,r=this,l=r.getCenterBorderEl(),n=r.cls;i.remove(n,"neo-focus"),l&&r.isEmpty()?(r._cls=n,t=r.vdom,delete l.width,r.vdom=t):r.cls=n}onInputValueChange(e){let t=this,r=e.value,i=t.value,l=n.findChildVnode(t.vnode,{nodeName:"input"});l&&(l.vnode.attributes.value=r),r!==i&&(t.value=r)}removeTrigger(e,t=!1,r){let l,n=this,o=!1,a=r||n.triggers||[],d=0,s=a.length;for(;d<s;d++)l=a[d],l.type===e&&(i.remove(a,l),s--,o=!0);return o&&!t&&(n.triggers=a),o}reset(e=null){e&&this.clearToOriginalValue&&(this.originalConfig.value=e),super.reset(e)}updateCenterBorderElWidth(e=!1){let t=this;t.mounted&&Neo.main.DomAccess.getBoundingClientRect({id:t.getCenterBorderEl().id}).then((r=>{if(t.centerBorderElWidth=Math.round(.7*r.width)+8,!e){let e=t.vdom;t.getCenterBorderEl().width=t.centerBorderElWidth,t.vdom=e}}))}updateInputWidth(){let e=this,t=e.getInputWidth(),r=e.vdom;null!==t&&t!==e.width?r.cn[1].width=t:delete r.cn[1].width,e.vdom=r}updateTriggerVnodes(){let e,t=this,r=t.vnode?.childNodes[1];(r?.childNodes||[]).forEach((r=>{e=t.getTriggerById(r.id),e&&Object.assign(e,{vnode:r,_rendered:!0,_mounted:!0})}))}}Neo.applyClassConfig(o);export{o as default};