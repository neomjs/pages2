import e from"../../container/Base.mjs";import t from"./trigger/Picker.mjs";import i from"./Text.mjs";import r from"../../util/VDom.mjs";class c extends i{static getConfig(){return{className:"Neo.form.field.Picker",ntype:"pickerfield",clientRects:null,cls:["neo-pickerfield","neo-textfield"],keys:{Enter:"onKeyDownEnter",Escape:"onKeyDownEscape"},matchPickerWidth:!0,picker:null,pickerConfig:null,pickerHeight:100,pickerIsMounted_:!1,pickerMaxHeight:200,pickerWidth:100,triggers:[{module:t}]}}applyClientRects(e){let t=this,i=t.clientRects,r=(i[2],i[1]),c=i[0],n=t.picker.vdom,o=t.matchPickerWidth?r.width-1:t.pickerWidth;t.pickerWidth=o,n.style=n.style||{},Object.assign(n.style,{left:c.left+c.width-o+"px",top:`${c.top+c.height+1}px`,width:`${o}px`}),t.picker[e?"_vdom":"vdom"]=n}createPicker(){let t=this,i=t.createPickerComponent();return Neo.create(e,{appName:t.appName,cls:["neo-picker-container","neo-container"],height:t.pickerHeight,id:t.getPickerId(),items:i?[i]:[],maxHeight:t.pickerMaxHeight,vdom:{cn:[],tabIndex:-1},width:t.pickerWidth,...t.pickerConfig})}createPickerComponent(){return null}getClientRectsThenShow(e,t){let i=this;Neo.main.DomAccess.getBoundingClientRect({id:[i.id,i.getInputWrapperId(),"body"]}).then((r=>{i.clientRects=r,i.showPicker(e,t)}))}getPicker(){let e=this;return e.picker||(e.picker=e.createPicker()),e.picker}getPickerId(){return`${this.id}__picker`}hidePicker(e=!1){let t=this,i=t.getPicker(),c=t.vdom;t.pickerIsMounted&&r.removeVdomChild(c,t.getPickerId()),t.pickerIsMounted=!1,e?(t._vdom=c,i.mounted=!1):t.promiseVdomUpdate().then((e=>{i.mounted=t.pickerIsMounted}))}onFocusLeave(e){let t=this;"inline"!==t.labelPosition||""!==t.value&&null!==t.value?t.hidePicker():t.hidePicker(!0),super.onFocusLeave(e)}onKeyDownEnter(e,t,i){!this.pickerIsMounted&&this.getClientRectsThenShow(t,i)}onKeyDownEscape(e){this.pickerIsMounted&&this.hidePicker()}onPickerTriggerClick(){let e=this;e.pickerIsMounted?e.hidePicker():e.getClientRectsThenShow()}showPicker(e,t){let i=this,r=i.getPicker(),c=i.vdom;i.applyClientRects(!0),c.cn.push(r.vdom),i.promiseVdomUpdate().then((c=>{i.pickerIsMounted=!0,r.mounted=i.pickerIsMounted,e?.apply(t||i)}))}}Neo.applyClassConfig(c);export{c as default};