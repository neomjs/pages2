import e from"../util/ClassSystem.mjs";import t from"../component/Base.mjs";import o from"../selection/ListModel.mjs";import r from"../util/Array.mjs";import s from"../data/Store.mjs";class i extends t{static getConfig(){return{className:"Neo.list.Base",ntype:"list",autoDestroyStore:!0,cls:["neo-list-container","neo-list"],disableSelection_:!1,displayField:"name",draggable_:!1,dragZone:null,dragZoneConfig:null,highlightFilterValue:!0,itemCls:"neo-list-item",itemTagName:"li",keys:{},selectionModel_:null,silentSelect:!1,store_:null,useCheckBoxes_:!1,_vdom:{tag:"ul",cn:[]}}}constructor(e){super(e);let t=this,o=t.domListeners;o.push({click:{fn:t.onClick,scope:t}}),t.domListeners=o}afterSetDisableSelection(e,t){e&&this.rendered&&this.selectionModel?.deselectAll()}afterSetDraggable(e,t){let o=this;e&&!o.dragZone&&import("../draggable/list/DragZone.mjs").then((e=>{o.dragZone=Neo.create({module:e.default,appName:o.appName,owner:o,...o.dragZoneConfig})}))}afterSetSelectionModel(e,t){this.rendered&&e.register(this)}afterSetStore(e,t){let o=this;e?.on({filter:o.onStoreFilter,load:o.onStoreLoad,recordChange:o.onStoreRecordChange,scope:o}),e?.getCount()>0&&o.onStoreLoad()}afterSetUseCheckBoxes(e,t){let o=this.cls;r[e?"add":"remove"](o,"neo-use-checkicons"),this.cls=o}beforeSetSelectionModel(t,r){return r&&r.destroy(),e.beforeSetInstance(t,o)}beforeSetStore(t,o){return o&&o.destroy(),e.beforeSetInstance(t,s)}createItem(e,t){let o,r=this,s=[r.itemCls],i=r.createItemContent(e,t),l=r.getItemId(e[r.getKeyProperty()]),n=r.selectionModel;switch(!r.disableSelection&&n&&n.isSelected(l)&&s.push(n.selectedCls),o={tag:r.itemTagName,cls:s,id:r.getItemId(e[r.getKeyProperty(l)]),tabIndex:-1},Neo.typeOf(i)){case"Array":o.cn=i;break;case"Object":Object.assign(o,i);break;case"String":o.html=i}return o}createItemContent(e,t){let o,r=this,s=e[r.displayField];return r.highlightFilterValue&&(o=r.store.getFilter(r.displayField),o&&null!==o.value&&""!==o.value&&(s=s.replace(new RegExp(o.value,"gi"),(function(e){return'<span class="neo-highlight-search">'+e+"</span>"})))),s}createItems(e=!1){let t=this,o=t.vdom;o.cn=[],t.store.items.forEach(((e,r)=>{o.cn.push(t.createItem(e,r))})),e?t._vdom=o:t.promiseVdomUpdate().then((()=>{t.fire("createItems")}))}destroy(){let e=this;e.selectionModel?.destroy(),e.autoDestroyStore&&e.store?.destroy(),super.destroy()}focus(e){super.focus(e),e&&Neo.main.DomAccess.scrollIntoView({behavior:"auto",id:e||this.id})}getItemId(e){return`${this.id}__${e}`}getItemRecordId(e){let t=e.split("__")[1],o=this.store.model,r=o?.getField(o.keyProperty);return"integer"!==r?.type.toLowerCase()&&"number"!==r?.type.toLowerCase()||(t=parseInt(t)),t}getKeyProperty(){return this.store.keyProperty||this.store.model.keyProperty}onClick(e){let t,o=this;if(e.path[0].id===o.id)o.onContainerClick(e);else for(t of e.path)if(t.cls.includes(o.itemCls)){o.onItemClick(t,e);break}}onConstructed(){super.onConstructed(),this.selectionModel?.register(this)}onContainerClick(e){this.fire("containerClick",e)}onItemClick(e,t){let o=this;!o.disableSelection&&o.selectionModel?.select(e.id),o.fire("itemClick",o.store.get(o.getItemRecordId(e.id)))}onStoreFilter(){this.createItems()}onStoreLoad(){let e,t=this;!t.mounted&&t.rendering?e=t.on("rendered",(()=>{t.un("rendered",e),t.createItems()})):t.createItems()}onStoreRecordChange(e){let t=this,o=e.index,r=t.vdom;o>-1&&(r.cn[o]=t.createItem(e.record,o),t.vdom=r)}selectItem(e){!this.disableSelection&&this.selectionModel?.selectAt(e)}}Neo.applyClassConfig(i);export{i as default};