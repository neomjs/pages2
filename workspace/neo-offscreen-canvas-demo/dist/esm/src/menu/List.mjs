import e from"../list/Base.mjs";import t from"../selection/menu/ListModel.mjs";import n from"../util/Array.mjs";import s from"./Store.mjs";class o extends e{static getConfig(){return{className:"Neo.menu.List",ntype:"menu-list",activeSubMenu:null,cls:["neo-menu-list","neo-list"],floating_:!1,focusTimeoutId:null,items_:null,menuFocus_:!1,isRoot:!0,parentIndex:0,parentMenu:null,selectionModel:t,store:s,subMenuGap:0,subMenuMap:null,zIndex_:100}}afterSetFloating(e,t){let s=this.cls;n[e?"add":"remove"](s,"neo-floating"),this.cls=s}afterSetItems(e,t){let n=this.store;t&&n.remove(t),e&&n.add(e)}afterSetMenuFocus(e,t){if(void 0!==t){let t=this;t.isRoot?e?(clearTimeout(t.focusTimeoutId),t.focusTimeoutId=null):t.focusTimeoutId=setTimeout((()=>{t[t.floating?"unmount":"hideSubMenu"]()}),20):t.parentMenu.menuFocus=e}}afterSetZIndex(e,t){this.style={...this.style,zIndex:e}}createItemContent(e,t){let n=this,s=e[n.store.keyProperty],o=[{tag:"span",cls:["neo-content"],html:e[n.displayField]}];return e.iconCls&&""!==e.iconCls&&o.unshift({tag:"i",cls:["neo-menu-icon","neo-icon",e.iconCls],id:n.getIconId(s)}),n.hasChildren(e)&&o.push({tag:"i",cls:["neo-arrow-icon","neo-icon","fas fa-chevron-right"],id:n.getArrowIconId(s)}),o}destroy(...e){let t=this,n=t.activeSubMenu,s=t.subMenuMap;t.store.destroy(),n&&n.unmount(),Object.entries(s).forEach((([e,t])=>{t.destroy(),s[e]=null})),super.destroy(...e)}getArrowIconId(e){return`${this.id}__arrow_icon__${e}`}getIconId(e){return`${this.id}__icon__${e}`}getMenuMapId(e){return`menu__${e}`}hasChildren(e){return Array.isArray(e.items)&&e.items.length>0}hideSubMenu(){let e=this,t=e.activeSubMenu;t&&(t.unmount(),e.activeSubMenu=null)}onFocusEnter(e){this.menuFocus=!0}onFocusLeave(e){this.menuFocus=!1}onSelect(e){let t=this,n=e[0],s=t.getItemRecordId(n),o=t.store.get(s);t.activeSubMenu!==t.subMenuMap?.[t.getMenuMapId(s)]&&(t.hideSubMenu(),t.hasChildren(o)&&t.showSubMenu(n,o))}showSubMenu(e,t){let n,s,u=this,i=u.store,r=t[i.keyProperty],a=u.subMenuMap||{},l=u.getMenuMapId(r),c=a[l];Neo.main.DomAccess.getBoundingClientRect({appName:u.appName,id:e}).then((e=>{s={left:`${e.right+u.subMenuGap}px`,top:e.top-1+"px"},c?(n=c.style,Object.assign(n,s),c.setSilent({style:n})):a[l]=c=Neo.create({module:o,appName:u.appName,floating:!0,items:t.items,isRoot:!1,parentId:Neo.apps[u.appName].mainView.id,parentIndex:i.indexOf(t),parentMenu:u,style:s,zIndex:u.zIndex+1}),u.activeSubMenu=c,u.subMenuMap=a,c.render(!0)}))}unmount(){this.selectionModel.deselectAll(!0),this.hideSubMenu(),super.unmount()}}Neo.applyClassConfig(o);export{o as default};