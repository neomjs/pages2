import e from"./Model.mjs";import o from"../util/Array.mjs";class t extends e{static getConfig(){return{className:"Neo.selection.GalleryModel",ntype:"selection-gallerymodel",stayInRow:!1}}addDomListener(){}onContainerClick(){let e=this,o=e.view,t=[...e.items],n=[];e.items.forEach((e=>{n.push({id:o.getItemVnodeId(e),cls:{add:[],remove:["neo-selected"]}})})),e.items.splice(0,e.items.length),Neo.currentWorker.promiseMessage("main",{action:"updateDom",appName:o.appName,deltas:n}).then((()=>{e.fire("selectionChange",e.items,t)}))}onItemClick(e){let o,t=0,n=e.path.length,s=this.view;for(;t<n;t++)if(e.path[t].cls.includes("neo-gallery-item")){o=s.getItemId(e.path[t].id),this.select(o),s.fire("select",{record:s.store.get(o)});break}}onKeyDownDown(e){this[this.view.orderByRow?"onNavKeyRow":"onNavKeyColumn"](1)}onKeyDownLeft(e){this[this.view.orderByRow?"onNavKeyColumn":"onNavKeyRow"](-1)}onKeyDownRight(e){this[this.view.orderByRow?"onNavKeyColumn":"onNavKeyRow"](1)}onKeyDownUp(e){this[this.view.orderByRow?"onNavKeyRow":"onNavKeyColumn"](-1)}onNavKeyColumn(e=1){let o,t,n=this,s=n.view,i=s.store,r=n.items[0],l=i.getCount();o=r?i.indexOf(r)+e:0,o<0?o=l-1:o>=l&&(o=0),t=i.getAt(o),n.select(t[i.keyProperty]),s.fire("select",{record:t})}onNavKeyRow(e=1){let o,t,n=this,s=n.view,i=s.store,r=n.items[0],l=i.getCount(),a=s.amountRows,c=n.stayInRow;if(s.orderByRow&&(a=Math.ceil(s.store.getCount()/a)),e*=a,o=r?i.indexOf(r)+e:0,o<0)for(c||o++;o<l-a;)o+=a;else if(o>=l)for(c||o--;o>=a;)o-=a;t=i.getAt(o),n.select(t[i.keyProperty]),s.fire("select",{record:t})}register(e){super.register(e);let o=this,t=o.id,n=o.view;n.on({containerClick:o.onContainerClick,itemClick:o.onItemClick,scope:o}),n.keys&&n.keys._keys.push({fn:"onKeyDownDown",key:"Down",scope:t},{fn:"onKeyDownLeft",key:"Left",scope:t},{fn:"onKeyDownRight",key:"Right",scope:t},{fn:"onKeyDownUp",key:"Up",scope:t})}select(e){let t=this,n=t.view,s=t.items,i=[...s],r=[],l=n.getItemVnodeId(e);t.singleSelect&&(t.items.forEach((o=>{o!==e&&r.push({id:n.getItemVnodeId(o),cls:{add:[],remove:["neo-selected"]}})})),s.splice(0,s.length)),r.push({id:l,cls:{add:["neo-selected"]}}),o.add(s,e),r.length>0&&n.mounted?Neo.currentWorker.promiseMessage("main",{action:"updateDom",appName:n.appName,deltas:r}).then((()=>{n.onSelect?.(s),t.fire("selectionChange",s,i)})):n.mounted&&(n.onSelect?.(s),t.fire("selectionChange",s,i))}unregister(){let e=this.id,o=this.view;o.keys&&o.keys.removeKeys([{fn:"onKeyDownDown",key:"Down",scope:e},{fn:"onKeyDownLeft",key:"Left",scope:e},{fn:"onKeyDownRight",key:"Right",scope:e},{fn:"onKeyDownUp",key:"Up",scope:e}]),super.unregister()}}Neo.applyClassConfig(t);export{t as default};