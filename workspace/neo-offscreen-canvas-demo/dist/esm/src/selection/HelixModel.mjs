import e from"./Model.mjs";import t from"../util/Array.mjs";class o extends e{static getConfig(){return{className:"Neo.selection.HelixModel",ntype:"selection-helixmodel",stayInColumn:!1}}addDomListener(){}onContainerClick(){let e=this,t=e.view,o=[...e.items],n=[];e.items.forEach((e=>{n.push({id:t.getItemVnodeId(e),cls:{add:[],remove:["neo-selected"]}})})),e.items.splice(0,e.items.length),Neo.currentWorker.promiseMessage("main",{action:"updateDom",appName:t.appName,deltas:n}).then((()=>{e.fire("selectionChange",e.items,o)}))}onItemClick(e){let t,o=0,n=e.path.length,s=this.view;for(;o<n;o++)if(e.path[o].cls.includes("neo-helix-item")){t=s.getItemId(e.path[o].id),this.select(t),s.fire("select",{record:s.store.get(t)});break}}onKeyDownDown(e){this.onNavKeyColumn(1)}onKeyDownLeft(e){this.onNavKeyRow(-1)}onKeyDownRight(e){this.onNavKeyRow(1)}onKeyDownUp(e){this.onNavKeyColumn(-1)}onNavKeyColumn(e=1){let t,o,n=this,s=n.view,i=s.store,l=n.items[0],r=i.getCount(),c=parseInt(360/s.itemAngle),a=n.stayInColumn;if(e*=c,t=l?i.indexOf(l)+e:0,t<0)for(a||t++;t<r-c;)t+=c;else if(t>=r)for(a||t--;t>=c;)t-=c;o=i.getAt(t),n.select(o[i.keyProperty]),s.fire("select",{record:o})}onNavKeyRow(e=1){let t,o,n=this,s=n.view,i=s.store,l=n.items[0],r=i.getCount();t=l?i.indexOf(l)+e:0,t<0?t=r-1:t>=r&&(t=0),o=i.getAt(t),n.select(o[i.keyProperty]),s.fire("select",{record:o})}register(e){super.register(e);let t=this,o=t.id,n=t.view;n.on({containerClick:t.onContainerClick,itemClick:t.onItemClick,scope:t}),n.keys&&n.keys._keys.push({fn:"onKeyDownDown",key:"Down",scope:o},{fn:"onKeyDownLeft",key:"Left",scope:o},{fn:"onKeyDownRight",key:"Right",scope:o},{fn:"onKeyDownUp",key:"Up",scope:o})}select(e,o=!0){let n=this,s=n.view,i=!1!==o&&n.items.includes(e),l=n.items,r=[...l],c=[];n.singleSelect&&(l.forEach((t=>{t.id!==e&&c.push({id:s.getItemVnodeId(t),cls:{add:[],remove:["neo-selected"]}})})),l.splice(0,l.length)),c.push({id:s.getItemVnodeId(e),cls:{add:i?[]:["neo-selected"],remove:i?["neo-selected"]:[]}}),t[i?"remove":"add"](l,e),s.mounted&&Neo.currentWorker.promiseMessage("main",{action:"updateDom",appName:s.appName,deltas:c}).then((()=>{s.onSelect?.(l),n.fire("selectionChange",l,r)}))}unregister(){let e=this.id,t=this.view;t.keys&&t.keys.removeKeys([{fn:"onKeyDownDown",key:"Down",scope:e},{fn:"onKeyDownLeft",key:"Left",scope:e},{fn:"onKeyDownRight",key:"Right",scope:e},{fn:"onKeyDownUp",key:"Up",scope:e}]),super.unregister()}}Neo.applyClassConfig(o);export{o as default};