import e from"./Base.mjs";import o from"../draggable/DragZone.mjs";import t from"../util/Array.mjs";class n extends e{static getStaticConfig(){return{cursorPositions:["s","sw","se","w","e","n","nw","ne"],nameRegEx:/-([a-z])/g,positions:["bottom","bottom-left","bottom-right","left","right","top","top-left","top-right"],validDirections:["b","bl","br","l","r","t","tl","tr"]}}static getConfig(){return{className:"Neo.plugin.Resizable",ntype:"plugin-resizable",appName_:null,boundaryContainerId:"document.body",boundaryContainerRect:null,currentNodeName:null,delegationCls:null,directions_:["b","bl","br","l","r","t","tl","tr"],dragZone:null,dragZoneConfig:null,gap:10,initialRect:null,isDragging:!1,maxHeight:null,maxWidth:null,minHeight:200,minWidth:200,nodeBottom:null,nodeBottomLeft:null,nodeBottomRight:null,nodeLeft:null,nodeRight:null,nodeTop:null,nodeTopLeft:null,nodeTopRight:null,targetNode:null}}constructor(e){super(e);let o=this,t=o.owner.domListeners;t.push({"drag:end":o.onDragEnd,scope:o,delegate:".neo-resizable"},{"drag:move":o.onDragMove,scope:o,delegate:".neo-resizable"},{"drag:start":o.onDragStart,scope:o,delegate:".neo-resizable"},{mousedown:o.onMouseDown,scope:o,delegate:".neo-resizable"},{mousemove:o.onMouseMove,scope:o,local:!0},{mouseleave:o.onMouseLeave,scope:o,delegate:`.${o.delegationCls}`},{mouseup:o.onMouseUp,scope:o,delegate:".neo-resizable"}),o.owner.domListeners=t}addBodyCursorCls(){Neo.currentWorker.promiseMessage("main",{action:"updateDom",appName:this.appName,deltas:{id:"document.body",cls:{add:[`neo-cursor-${n.cursorPositions[n.positions.indexOf(this.currentNodeName)]}-resize`],remove:[]}}})}addNode(e){let o=this,t="node"+Neo.capitalize(e.replace(n.nameRegEx,((e,o)=>o.toUpperCase()))),r=o.targetNode;return!!r&&(o.currentNodeName=e,o[t]={cls:["neo-resizable",`neo-resizable-${e}`]},r.cn=r.cn||[],r.cn.push(o[t]),!0)}afterSetAppName(e,o){let t=this;e&&Neo.currentWorker.insertThemeFiles(e,t.__proto__),t.dragZone&&(t.dragZone.appName=e)}beforeSetDirections(e,o){if(Array.isArray(e)){let t=0,n=e.length;for(;t<n;t++)if(this.beforeSetEnumValue(e[t],o,"directions","validDirections")!==e[t])return o}return e}onDragEnd(e){let o=this,t=o.owner.wrapperStyle;Object.assign(o,{boundaryContainerRect:null,initialRect:null,isDragging:!1}),Object.assign(t,{opacity:1,transform:"none",...o.dragZone.dragProxy.wrapperStyle}),o.owner.wrapperStyle=t,o.removeBodyCursorCls(),o.dragZone.dragEnd(),o.removeAllNodes()}onDragMove(e){let o,t,n,r=this,a=r.currentNodeName,i=r.boundaryContainerRect,d=r.maxHeight,l=r.maxWidth,s=r.minHeight,g=r.minWidth,m=r.initialRect;a?r.dragZone.dragProxy&&(n=r.dragZone.dragProxy.wrapperStyle,a.includes("bottom")?(t=Math.max(s,e.clientY-m.top),d&&(t=Math.min(t,d)),i&&(t=Math.min(t,i.bottom-m.top)),n.height=`${t}px`):a.includes("top")&&(o=Math.min(m.bottom-s,e.clientY),t=Math.max(s,m.height+m.top-e.clientY),d&&(o=Math.max(o,m.bottom-d),t=Math.min(t,d)),i&&(o=Math.max(o,i.top),t=Math.min(t,m.bottom-i.top)),n.height=`${t}px`,n.top=`${o}px`),a.includes("left")?(o=Math.min(m.right-g,e.clientX),t=Math.max(g,m.width+m.left-e.clientX),l&&(o=Math.max(o,m.right-l),t=Math.min(t,l)),i&&(o=Math.max(o,i.left),t=Math.min(t,m.right-i.left)),n.left=`${o}px`,n.width=`${t}px`):a.includes("right")&&(t=Math.max(g,m.width-m.right+e.clientX),l&&(t=Math.min(t,l)),i&&(t=Math.min(t,i.right-m.left)),n.width=`${t}px`),r.dragZone.dragProxy.wrapperStyle=n):r.onDragEnd({})}onDragStart(e){let t,n=this,r=n.boundaryContainerId,a=0,i=e.path.length,d=n.owner,l=n.appName,s=d.wrapperStyle;for(n.isDragging=!0,s.opacity=.3,n.owner.wrapperStyle=s;a<i;a++)if(t=e.path[a],t.cls.includes(n.delegationCls)&&(n.initialRect=t.rect),r&&("document.body"===r&&"body"===t.tagName||r===t.id)){n.boundaryContainerRect=t.rect;break}n.boundaryContainerRect||Neo.main.DomAccess.getBoundingClientRect({appName:l,id:n.boundaryContainerRect}).then((e=>{n.boundaryContainerRect=e})),n.addBodyCursorCls(),n.dragZone?n.dragZone.boundaryContainerId=d.boundaryContainerId:n.dragZone=Neo.create({module:o,appName:l,boundaryContainerId:d.boundaryContainerId,dragElement:d.vdom,moveInMainThread:!1,owner:d,...n.dragZoneConfig}),n.dragZone.dragStart(e)}onMouseDown(e){this.isDragging=!0}onMouseMove(e){let o,t,n,r,a,i=this,d=i.directions,l=0,s=i.gap,g=!1,m=e.path.length,p=i.owner,c=i.targetNode,u=p.vdom;if(!i.isDragging&&!p.isDragging){for(;l<m;l++)if(e.path[l].cls.includes(i.delegationCls)){r=e.path[l];break}r&&(r.id!==(c&&c.id)&&(c&&i.removeAllNodes(),i.targetNode=p.getVdomChild(r.id)),o=e.clientY>=r.rect.y-s+r.rect.height,t=e.clientX<=r.rect.x+s,n=e.clientX>=r.rect.x-s+r.rect.width,a=e.clientY<=r.rect.y+s,i.nodeBottom&&(!o||o&&t||o&&n)&&(g=i.removeNode("bottom")),i.nodeLeft&&(!t||o&&t||a&&t)&&(g=i.removeNode("left")),i.nodeRight&&(!n||o&&n||a&&n)&&(g=i.removeNode("right")),i.nodeTop&&(!a||a&&t||a&&n)&&(g=i.removeNode("top")),!i.nodeBottomLeft||o&&t||(g=i.removeNode("bottom-left")),!i.nodeBottomRight||o&&n||(g=i.removeNode("bottom-right")),!i.nodeTopLeft||a&&t||(g=i.removeNode("top-left")),!i.nodeTopRight||a&&n||(g=i.removeNode("top-right")),d.includes("bl")&&o&&t?i.nodeBottomLeft||(g=i.addNode("bottom-left")):d.includes("br")&&o&&n?i.nodeBottomRight||(g=i.addNode("bottom-right")):d.includes("tl")&&a&&t?i.nodeTopLeft||(g=i.addNode("top-left")):d.includes("tr")&&a&&n?i.nodeTopRight||(g=i.addNode("top-right")):d.includes("b")&&o?i.nodeBottom||(g=i.addNode("bottom")):d.includes("l")&&t?i.nodeLeft||(g=i.addNode("left")):d.includes("r")&&n?i.nodeRight||(g=i.addNode("right")):d.includes("t")&&a&&(i.nodeTop||(g=i.addNode("top"))),g&&(p.vdom=u))}}onMouseLeave(e){let o=this;o.isDragging||o.owner.isDragging||e.path[0].cls.includes(o.delegationCls)&&o.removeAllNodes()}onMouseUp(e){this.isDragging=!1}removeAllNodes(){let e=this,o=e.owner.vdom;e.currentNodeName&&(e.removeNode(e.currentNodeName),e.owner.vdom=o,e.currentNodeName=null,e.targetNode=null)}removeBodyCursorCls(){Neo.currentWorker.promiseMessage("main",{action:"updateDom",appName:this.appName,deltas:{id:"document.body",cls:{add:[],remove:[`neo-cursor-${n.cursorPositions[n.positions.indexOf(this.currentNodeName)]}-resize`]}}})}removeNode(e){let o=this,r="node"+Neo.capitalize(e.replace(n.nameRegEx,((e,o)=>o.toUpperCase())));return!!o[r]&&(o.currentNodeName=null,t.remove(o.targetNode.cn,o[r]),o[r]=null,!0)}}Neo.applyClassConfig(n);export{n as default};